<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="FpostCommentDao">
    <!-- resultMap 정의 -->
    <resultMap id="FCommentResultMap" type="com.gameboard.biz.post.FpostComment">
        <id property="fCommentID" column="fCommentID"/>
        <result property="fID" column="fID"/>
        <result property="userID" column="userID"/>
        <result property="fCommentDate" column="fCommentDate"/>
        <result property="sfCommentContent" column="fCommentContent"/>
    </resultMap>

	<!-- 댓글 추가 -->
	<insert id="insertFComment"
		parameterType="com.gameboard.biz.post.FpostComment">
		INSERT INTO FAQ_BOARD_COMMENT (
		fCommentID,
		fID,
		userID,
		fCommentContent
		) VALUES (
		(SELECT NVL(MAX(fCommentID), 0) + 1 FROM FAQ_BOARD_COMMENT),
		#{fID},
		#{userID},
		#{fCommentContent}
		)
	</insert>
	
	<select id="getFCommentDate" resultType="string">
    <![CDATA[
        SELECT TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI') AS currentDateTime FROM DUAL
    ]]>
	</select>
	
	<select id = "getFCommentID" resultType = "int">
		<![CDATA[
			SELECT NVL(MAX(sgCommentID, 0) +1
			FROM FAQ_BOARD_COMMENT
		]]>
	</select>

	<!-- 댓글 조회 -->
	<select id="selectFCommentsByPostId" parameterType="int"
		resultType="com.gameboard.biz.post.FpostComment">
		SELECT *
		FROM FAQ_BOARD_COMMENT
		WHERE sgID = #{sgID}
		ORDER BY commentDate DESC
	</select>
	
	<!-- 단일 객체 댓글 조회 -->
	<select id = "selectFCommentById" resultType="com.gameboard.biz.post.FpostComment">
		<![CDATA[
			SELECT * FROM FAQ_BOARD_COMMENT
			WHERE fCommentID = #{fCommentID}
		]]>
	</select>
	
	<!-- 단일 댓글 삭제 -->
	 <delete id="deleteFComment" parameterType="int">
        DELETE FROM FAQ_BOARD_COMMENT
        WHERE fCommentID = #fCommentID}
    </delete>
    
    <!-- 게시물 댓글 삭제 -->
    <delete id="deleteFAllComment" parameterType = "int">
    	DELETE FROM FAQ_BOARD_COMMENT
    	WHERE fID = #{fID}
    </delete>
    
    <!-- fID를 기준으로 댓글 카운트 -->
    <select id = "countFCommentsByPostId" parameterType = "int" resultType="int">
    	SELECT COUNT(*) FROM FAQ_BOARD_COMMENT
    	WHERE fID = #{fID}
    </select>
</mapper>